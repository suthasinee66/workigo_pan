<!DOCTYPE html>

<html class="light" lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Employer - Post a Job Form (Themed)</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#ff6a00",
            "background-light": "#f8f7f5",
            "background-dark": "#23170f",
            "dark-blue": "#1F3A5F",
            "light-gray": "#F5F7FA",
          },
          fontFamily: {
            "display": ["Manrope", "sans-serif"]
          },
          borderRadius: { "DEFAULT": "0.5rem", "lg": "0.75rem", "xl": "1rem", "full": "9999px" },
          boxShadow: {
            'soft': '0 4px 12px 0 rgba(0, 0, 0, 0.05)',
          }
        },
      },
    }
  </script>
  <style>
    .material-symbols-outlined {
      font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
      font-size: 24px
    }

    .form-select {
      background-image: url(https://lh3.googleusercontent.com/aida-public/AB6AXuDl1xhZU7hAJBb7QgINLXlPnHa9PWXu9LUPn7DsoA3KoW3BK0nBd-tGD0OcYMoVgw7txKFlrk7c7dF3AE37U06jgJ-D8HxvTuqK9QCnnKH3VHhNY4xsIukvNDMT39Z2PAI3HN1zIjeC1ELT-x014Zk7cIVfVJlcLEInNQ8-kSWF_Q8YKJk4VjYKhMSBKQiA70cwNJ2k7hAzWO2zC0dCVMQcWmzvaK6ZYNVwVM7cq_ikZ-tcWHlAArLZp12-vcSkcB4CGumIoG731N0l);
      background-position: right 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-right: 2.5rem;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none
    }
  </style>
  <style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

</head>


<body class="font-display bg-background-light dark:bg-background-dark">
  <div class="relative flex min-h-screen w-full flex-col">
    <!-- Top App Bar -->
    <header class="sticky top-0 z-10 flex h-16 items-center justify-between bg-dark-blue px-4 shadow-md">
      <button onclick="window.location.href='employer_home.html'"
        class="flex size-10 items-center justify-center rounded-full text-white">
        <span class="material-symbols-outlined">arrow_back_ios_new</span>
      </button>
      <h1 class="text-xl font-bold text-white">Post a Job</h1>
      <button onclick="window.location.href='employer_home.html'"
        class="flex size-10 items-center justify-center rounded-full text-white">
        <span class="material-symbols-outlined">draft</span>
      </button>
    </header>
    <!-- Form Content -->
    <main class="flex-1 space-y-4 p-4 pb-48">
      <!-- Job Information Card -->
      <div class="rounded-xl bg-light-gray p-4 shadow-soft">
        <h3 class="text-lg font-bold text-[#181410] mb-4">Job Information</h3>
        <div class="space-y-4">
          <label class="flex flex-col">
            <p class="text-base font-medium text-[#181410] pb-2">Job title</p>
            <input id="job_title"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 placeholder:text-gray-400 p-[15px] text-base font-normal leading-normal"
              placeholder="e.g. Barista" value="" />
          </label>
          <label class="flex flex-col">
            <p class="text-base font-medium text-[#181410] pb-2">Work time type</p>
            <select id="work_time_type"
              class="form-select w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 p-[15px] text-base font-normal leading-normal">
              <option value="">Select work time type</option>
              <option value="daily">Daily</option>
              <option value="hourly">Hourly</option>
              <option value="part-time">Part-time</option>
              <option value="full-time">Full-time</option>
            </select>
          </label>
          <label class="flex flex-col">
            <p class="text-base font-medium text-[#181410] pb-2">Job type</p>
            <select id="job_type" class="form-select w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 p-[15px] text-base font-normal leading-normal">>
  <option value="">Select job type</option>
</select>

          </label>
          <label class="flex flex-col">
            <p class="text-base font-medium text-[#181410] pb-2">Number of workers</p>
            <input id="workers_needed"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 placeholder:text-gray-400 p-[15px] text-base font-normal leading-normal"
              placeholder="e.g. 5" type="number" />
          </label>
        </div>
      </div>
      <!-- Job Details Card -->
      <div class="rounded-xl bg-light-gray p-4 shadow-soft">
        <h3 class="text-lg font-bold text-[#181410] mb-4">Job Details</h3>
        <div class="space-y-4">
          <label class="flex flex-col">
            <p class="text-base font-medium text-[#181410] pb-2">Job description</p>
            <textarea id="job_description"
              class="form-textarea flex w-full min-w-0 flex-1 resize-y overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white min-h-[120px] placeholder:text-gray-400 p-[15px] text-base font-normal leading-normal"
              placeholder="Describe the responsibilities and tasks..."></textarea>
          </label>
          <label class="flex flex-col">
            <p class="text-base font-medium text-[#181410] pb-2">Qualifications</p>
            <input id="qualifications"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 placeholder:text-gray-400 p-[15px] text-base font-normal leading-normal"
              placeholder="e.g. Food handling certificate" value="" />
          </label>
          <!-- Gender & Age -->
          <label class="flex flex-col mb-6">
            <p class="text-base font-medium pb-2">
              Gender & Age requirements
              <span class="text-gray-500 font-normal">(optional)</span>
            </p>

            <div class="grid grid-cols-2 gap-3">
              <select id="gender_requirement" class="form-select h-14 rounded-lg border-gray-200">
                <option value="">Any gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
              </select>

              <input id="age_requirement" class="form-input h-14 rounded-lg border-gray-200"
                placeholder="e.g. 18+, 20-35" />
            </div>
          </label>

        </div>
      </div>
      <!-- Payment Card -->
      <div class="rounded-xl bg-light-gray p-4 shadow-soft">
        <h3 class="text-lg font-bold text-[#181410] mb-4">Payment</h3>
        <div class="grid grid-cols-2 gap-4">
          <label class="flex flex-col col-span-1">
            <p class="text-base font-medium text-[#181410] pb-2">Wage type</p>
            <select id="wage_type"
              class="form-select w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 p-[15px] text-base font-normal leading-normal">
              <option value="">Select</option>
              <option value="daily">Daily</option>
              <option value="hourly">Hourly</option>
            </select>
          </label>
          <label class="flex flex-col col-span-1">
            <p class="text-base font-medium text-[#181410] pb-2">Wage amount</p>
            <input id="wage_amount"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 placeholder:text-gray-400 p-[15px] text-base font-normal leading-normal"
              placeholder="e.g. 150" type="number" />
          </label>
        </div>
        <label class="flex flex-col mt-4">
          <p class="text-base font-medium text-[#181410] pb-2">Payment method</p>
          <select id="payment_method"
            class="form-select w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 p-[15px] text-base font-normal leading-normal">
            <option value="">Select method</option>
            <option value="cash">Cash</option>
            <option value="bank">Bank Transfer</option>
          </select>
        </label>
      </div>
      <!-- Work Location Card -->
      <div class="rounded-xl bg-light-gray p-4 shadow-soft">
        <h3 class="text-lg font-bold text-[#181410] mb-4">Work Location</h3>
        <div class="space-y-4">
          <label class="flex flex-col">
            <p class="text-base font-medium text-[#181410] pb-2">Workplace name</p>
            <input id="workplace_name"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 placeholder:text-gray-400 p-[15px] text-base font-normal leading-normal"
              placeholder="e.g. The Coffee Corner" value="" />
          </label>
          <label class="flex flex-col">
            <p class="text-base font-medium text-[#181410] pb-2">Address</p>
            <input id="address"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 placeholder:text-gray-400 p-[15px] text-base font-normal leading-normal"
              placeholder="Enter full address" value="" />
            <button type="button" onclick="searchAddress()"
              class="mt-2 w-full h-10 rounded-lg bg-gray-800 text-white text-sm font-medium">
              üìç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            </button>

          </label>
          <div>
            <div class="aspect-[16/9] bg-gray-200 rounded-lg overflow-hidden mt-2">
              <div class="aspect-[16/9] bg-gray-200 rounded-lg overflow-hidden mt-2">
                <div id="map" class="w-full h-full"></div>
              </div>

              <input type="hidden" id="latitude">
              <input type="hidden" id="longitude">

              <p id="map-status" class="text-sm text-gray-600 mt-2">
                ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
              </p>
            </div>
          </div>
        </div>
      </div>
      <!-- Work Schedule Card -->
      <div class="rounded-xl bg-light-gray p-4 shadow-soft">
        <h3 class="text-lg font-bold text-[#181410] mb-4">Work Schedule</h3>
        <div class="grid grid-cols-2 gap-4">
          <label class="flex flex-col">
            <p class="text-base font-medium text-[#181410] pb-2">Start date</p>
            <input id="start_date"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 placeholder:text-gray-400 p-[15px] text-base font-normal leading-normal"
              placeholder="Select date" type="date" />
          </label>
          <label class="flex flex-col">
            <p class="text-base font-medium text-[#181410] pb-2">End date</p>
            <input id="end_date"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 placeholder:text-gray-400 p-[15px] text-base font-normal leading-normal"
              placeholder="Select date" type="date" />
          </label>
          <label class="flex flex-col">
            <p class="text-base font-medium text-[#181410] pb-2">Start time</p>
            <input id="start_time"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 placeholder:text-gray-400 p-[15px] text-base font-normal leading-normal"
              placeholder="Select time" type="time" />
          </label>
          <label class="flex flex-col">
            <p class="text-base font-medium text-[#181410] pb-2">End time</p>
            <input id="end_time"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 placeholder:text-gray-400 p-[15px] text-base font-normal leading-normal"
              placeholder="Select time" type="time" />
          </label>
        </div>
      </div>
      <!-- Contact Card -->
      <div class="rounded-xl bg-light-gray p-4 shadow-soft">
        <h3 class="text-lg font-bold text-[#181410] mb-4">Contact</h3>
        <div class="space-y-4">
          <label class="flex flex-col">
            <p class="text-base font-medium text-[#181410] pb-2">Contact name</p>
            <input id="contact_name"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 placeholder:text-gray-400 p-[15px] text-base font-normal leading-normal"
              placeholder="e.g. John Doe" value="" />
          </label>
          <label class="flex flex-col">
            <p class="text-base font-medium text-[#181410] pb-2">Phone number</p>
            <input id="phone_number"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#181410] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-gray-200 bg-white h-14 placeholder:text-gray-400 p-[15px] text-base font-normal leading-normal"
              placeholder="Enter phone number" type="tel" />
          </label>
          <div class="flex items-center justify-between pt-2">
            <p class="text-base font-medium text-[#181410]">In-app chat enabled</p>
            <label class="relative inline-flex cursor-pointer items-center">
              <input checked="" class="peer sr-only" type="checkbox" value="" />
              <div
                class="peer h-7 w-12 rounded-full bg-gray-300 after:absolute after:start-[4px] after:top-[4px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all peer-checked:bg-primary peer-checked:after:translate-x-full peer-checked:after:border-white">
              </div>
            </label>
          </div>
        </div>
      </div>
    </main>
    <!-- Sticky Footer Action Bar -->
    <footer class="fixed bottom-0 left-0 right-0 z-10 bg-white/80 p-4 backdrop-blur-sm border-t border-gray-200">
      <div class="space-y-3">
        <button onclick="goPreview()"
          class="flex w-full cursor-pointer items-center justify-center overflow-hidden rounded-lg h-14 bg-primary text-white text-lg font-bold shadow-soft">
          Post Job
        </button>
    </footer>
  </div>
  <script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://ispbevvwwggbktfczmui.supabase.co",
  "sb_publishable_5pnSaiKllm-q7UNMe5r7pw_n4Qu-AJ7"
);

/* ================= URL PARAM ================= */
const params = new URLSearchParams(location.search);
const mode = params.get("mode");       // edit | null
const jobpostId = params.get("id");

/* ================= LOAD JOB TYPES ================= */
async function loadJobTypes() {
  const { data } = await supabase
    .from("job_types")
    .select("job_type_id, job_type")
    .order("job_type");

  const select = document.getElementById("job_type");

  data.forEach(t => {
    const opt = document.createElement("option");
    opt.value = t.job_type_id;   // FK
    opt.textContent = t.job_type; // ‡∏ä‡∏∑‡πà‡∏≠
    select.appendChild(opt);
  });
}

await loadJobTypes();


/* ================= MAP ================= */
let map, marker;
function placeMarker(lat, lng) {
  if (marker) {
    marker.setLatLng([lat, lng]);
  } else {
    marker = L.marker([lat, lng]).addTo(map);
  }
}

function setLatLng(lat, lng) {
  document.getElementById("latitude").value = lat;
  document.getElementById("longitude").value = lng;
}


function initMap(lat = 13.7563, lng = 100.5018) {
  if (map) return; // üî• ‡∏Å‡∏±‡∏ô‡∏û‡∏±‡∏á

  map = L.map("map").setView([lat, lng], 13);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: "¬© OpenStreetMap"
  }).addTo(map);

  map.on("click", e => {
    placeMarker(e.latlng.lat, e.latlng.lng);
    setLatLng(e.latlng.lat, e.latlng.lng);
  });
}

initMap();



/* ================= EDIT MODE ================= */
if (mode === "edit" && jobpostId) {
  const { data } = await supabase
    .from("jobposts")
    .select("*")
    .eq("jobpost_id", jobpostId)
    .single();

  job_title.value = data.job_title;
  job_description.value = data.job_description;
  work_time_type.value = data.work_time_type;
  job_type.value = data.job_type_id;
  workers_needed.value = data.workers_needed;
  qualifications.value = data.qualifications;
  wage_type.value = data.wage_type;
  wage_amount.value = data.wage_amount;
  payment_method.value = data.payment_method;
  workplace_name.value = data.workplace_name;
  address.value = data.address;
  age_requirement.value = data.age_requirement;
  gender_requirement.value = data.gender_requirement;
  start_date.value = data.start_date;
  end_date.value = data.end_date;
  start_time.value = data.start_time;
  end_time.value = data.end_time;
  contact_name.value = data.contact_name;
  phone_number.value = data.phone_number;
  latitude.value = data.latitude;
  longitude.value =data.longitude;
  contact_name.value = data.contact_name;


  

  map.setView([data.latitude, data.longitude], 15);
  placeMarker(data.latitude, data.longitude);
}


/* ================= PREVIEW ================= */
window.goPreview = function () {
  if (!latitude.value || !longitude.value) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà");
    return;
  }

  const draft = {
    job_title: job_title.value,
    work_time_type: work_time_type.value,
    job_type_id: Number(job_type.value),
    job_description: job_description.value,
    qualifications: qualifications.value,
    workers_needed: Number(workers_needed.value || 0),
    wage_type: wage_type.value,
    wage_amount: wage_amount.value,
    payment_method: payment_method.value,
    workplace_name: workplace_name.value,
    address: address.value,
    latitude: latitude.value,
    longitude: longitude.value,
    age_requirement: age_requirement.value,
    start_date: start_date.value,
    end_date: end_date.value,
    start_time: start_time.value,
    end_time: end_time.value,
    phone_number: phone_number.value,
    contact_name: contact_name.value

  };

  localStorage.setItem("jobPostDraft", JSON.stringify(draft));

  location.href =
    mode === "edit"
      ? `employer_post_job_preview.html?id=${jobpostId}&mode=edit`
      : `employer_post_job_preview.html?id=${draft}&mode=edit`;
};

/* ================= SEARCH ADDRESS ================= */
window.searchAddress = async function () {
  const q = address.value.trim();
  if (!q) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà");
    return;
  }

  const res = await fetch(
    `https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(q)}`
  );
  const data = await res.json();

  if (!data.length) {
    alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà");
    return;
  }

  const lat = parseFloat(data[0].lat);
  const lng = parseFloat(data[0].lon);

  map.setView([lat, lng], 16);   // ‚úÖ ‡∏ñ‡∏π‡∏Å
  placeMarker(lat, lng);
  setLatLng(lat, lng);
};

</script>


</body>

</html>